

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Setup &mdash; barrista  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="barrista  documentation" href="index.html"/>
        <link rel="next" title="Using barrista" href="usage.html"/>
        <link rel="prev" title="Welcome to barrista’s documentation!" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> barrista
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#caffe-modifications">Caffe modifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#registering-additional-layers">Registering additional layers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Using <cite>barrista</cite></a></li>
<li class="toctree-l1"><a class="reference internal" href="barrista.html">API documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">barrista</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Setup</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>This package has the following requirements:</p>
<ul class="simple">
<li>caffe, rc2 or newer,  built with the Python interface,</li>
<li>OpenCV (for automatic rescaling),</li>
<li>setuptools (for installation and building the documentation),</li>
<li>sphinx (for building the documentation).</li>
</ul>
</div>
<div class="section" id="caffe-modifications">
<h2>Caffe modifications<a class="headerlink" href="#caffe-modifications" title="Permalink to this headline">¶</a></h2>
<p>While barrista &#8216;serves&#8217; caffe right, some beans must be added for the
perfect flavor. This translates to just a few lines of C++ code that must
be changed in the core library.</p>
<p>We offer a .patch file for various versions since caffe rc2. But even
if you are not using one of these version, don&#8217;t worry, you will be able to
easily add them by hand. Alternatively, you can run:</p>
<div class="highlight-python"><div class="highlight"><pre>git submodule update --init
</pre></div>
</div>
<p>in the barrista folder, and an already patched caffe version is loaded to the
<cite>caffe</cite> subfolder of barrista. We keep this in sync with upstream caffe in
regular intervals, and you can build it as described by the
<a class="reference external" href="http://caffe.berkeleyvision.org/">BVLC team</a>.</p>
<p>The patch files are located in the barrista folder <cite>patches</cite> and can be applied
(for example) by navigating to your caffe root folder and executing:</p>
<div class="highlight-python"><div class="highlight"><pre>git apply ../path/to/barrista/patches/barrista-patch-[X].patch
</pre></div>
</div>
<p>If there is no patch available for your very caffe version, you should still
be able to quickly find out what lines to change by having a look at the
<cite>.patch</cite> files.</p>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Now that your <cite>caffe</cite> is ready, we will setup <cite>barrista</cite> so that it knows
what caffe to work with!</p>
<p>There are three ways to do this:</p>
<ol class="arabic simple">
<li>edit the source files,</li>
<li>set environment variables,</li>
<li>do it on-the-fly within your code.</li>
</ol>
<p>The first possibility is not as <cite>clean</cite> as the others (since, e.g., a
barrista update might break your config), but in case you want to do it:
the file <code class="docutils literal"><span class="pre">barrista/config.py</span></code> is all yours! It contains all relevant
information (the meaning of the variable <code class="docutils literal"><span class="pre">LAYER_TYPES</span></code> is discussed in
detail in the section <a class="reference internal" href="#registering-layers"><span>Registering additional layers</span></a>).</p>
<p>A clean way to let barrista know about the location of the <cite>caffe</cite> to use is,
to use the two environment variables <code class="xref py py-data docutils literal"><span class="pre">CAFFE_PYTHON_FOLDER</span></code> and
<code class="xref py py-data docutils literal"><span class="pre">CAFFE_BIN_FOLDER</span></code>. Whereas the first one points to the folder where
caffe&#8217;s Python module is located (usually <code class="docutils literal"><span class="pre">caffe/python</span></code>), the second one points
to the folder where all caffe executables are stored after having run
the installation (usually <code class="docutils literal"><span class="pre">caffe/build/install/bin</span></code>). This folder must contain
the executable <code class="docutils literal"><span class="pre">upgrade_net_proto_text</span></code>.</p>
<p>If you are working with many different <cite>caffe</cite> builds or want to swap them
on the fly, you can also do this easily! In this case:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Import the barrista&#39;s config module before any of the other modules!</span>
<span class="kn">import</span> <span class="nn">barrista.config</span>
<span class="c"># Change the two variable values to your liking:</span>
<span class="n">barrista</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">CAFFE_PYTHON_FOLDER</span> <span class="o">=</span> <span class="s">&#39;a/crazy/folder&#39;</span>
<span class="n">barrista</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">CAFFE_BIN_FOLDER</span> <span class="o">=</span> <span class="s">&#39;another/funny/one&#39;</span>
<span class="c"># Now use your configured barrista:</span>
<span class="kn">import</span> <span class="nn">barrista.design</span>
<span class="c"># ...</span>
</pre></div>
</div>
<p>A side note on the google logging facilities of caffe: the output is very useful
for debugging, but may clutter your terminal unnecessary otherwise. To change
the log-level, simply:</p>
<div class="highlight-python"><div class="highlight"><pre>export GLOG_minloglevel=2
</pre></div>
</div>
<p>and add this to your favorite place, e.g., <cite>.bashrc</cite>. The levels are 0 (debug,
default), 1 (info), 2 (warnings), 3 (errors).</p>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>Before installing barrista, you can (and should) run the tests to verify
proper configuration and compatibility by executing:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py test
</pre></div>
</div>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>You can install the project to your python installation by running:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py install
</pre></div>
</div>
<p>or, to be able to modify the software in its current folder while using it,
run:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py develop
</pre></div>
</div>
<p>If you want to build the documentation, run:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py build_sphinx
</pre></div>
</div>
<p>Should this command fail with an error message along the lines of
&#8216;<cite>build_sphinx</cite> is an invalid command&#8217;, just upgrade your distutils
installation by running <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--upgrade</span> <span class="pre">distutils</span></code> and it
should work.</p>
</div>
<div class="section" id="registering-additional-layers">
<span id="registering-layers"></span><h2>Registering additional layers<a class="headerlink" href="#registering-additional-layers" title="Permalink to this headline">¶</a></h2>
<p>The layer types and their parameters can, unfortunately, not be inferred
from the caffe protobuf protocols in a fully automatic manner.
Your standard barrista knows all the popularly used layer types that come with
the default caffe installation, but if you extend caffe, it is necessary
to register your new layers by hand. There are again two possibilities:</p>
<ol class="arabic simple">
<li>edit the file <code class="docutils literal"><span class="pre">config.py</span></code> by hand,</li>
<li>register the layer types on-the-fly during use.</li>
</ol>
<p>The responsible object is <a class="reference internal" href="barrista.html#barrista.config.LAYER_TYPES" title="barrista.config.LAYER_TYPES"><code class="xref py py-data docutils literal"><span class="pre">barrista.config.LAYER_TYPES</span></code></a>. It is a dictionary
with the layer name strings as keys, and a list of names of protobuf objects
that are the layer&#8217;s parameters, e.g.,:</p>
<div class="highlight-python"><div class="highlight"><pre>&#39;Convolution&#39;: [&#39;ConvolutionParameter&#39;]
</pre></div>
</div>
<p>is responsibe for registering the convolution layer.
You can simply edit <code class="docutils literal"><span class="pre">config.py</span></code> and add your own layers, or add them on the
fly as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">barrista.config</span>
<span class="c"># This must be done before importing any other submodule!</span>
<span class="n">barrista</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">LAYER_TYPES</span><span class="p">[</span><span class="s">&#39;Convolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;ConvolutionParameter&#39;</span><span class="p">]</span>
<span class="kn">import</span> <span class="nn">barrista.design</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="usage.html" class="btn btn-neutral float-right" title="Using barrista" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Welcome to barrista’s documentation!" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, University of Tuebingen.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>